---

 - hosts: localhost
   become: yes
  

   tasks:

    - name: ensure the jenkins apt repository key is installed

      apt_key: url=https://pkg.jenkins.io/debian-stable/jenkins.io.key state=present

      become: yes



    - name: ensure the repository is configured

      apt_repository: repo='deb https://pkg.jenkins.io/debian-stable binary/' state=present

      become: yes




    - name: Install Java, Jenkins and Maven

      apt:

        name: '{{ packages }}'

        state: present

        update_cache: true

      vars:

        packages:

          - openjdk-11-jdk

          - maven

          - jenkins

    - name: Bypass Setup Wizard

      lineinfile:

        dest: /etc/default/jenkins

        regexp: '^JAVA_ARGS='

        line: 'JAVA_ARGS="-Djenkins.install.runSetupWizard=false"'

    - name: Copy Bypass Script
      
      ansible.builtin.copy:
        src: ~/devops2/init.groovy.d/basic-security.groovy
        dest: /var/lib/jenkins/init.groovy.d/basic-security.groovy


    - name: ensure jenkins is restarted and running

      service: name=jenkins state=restarted  
